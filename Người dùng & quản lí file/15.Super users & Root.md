## Super Users v√† Root

## 1. **`su`** v√† **`sudo`**

C√≥ s·ª± kh√°c bi·ªát l·ªõn gi·ªØa c√°c l·ªánh **`su`** v√† **`sudo`**:

- **`su`** chuy·ªÉn b·∫°n sang **t√†i kho·∫£n ng∆∞·ªùi d√πng `root`**.
- **`sudo`** ch·∫°y l·ªánh v·ªõi **ƒë·∫∑c quy·ªÅn `root`**.

V·ªÅ c∆° b·∫£n, **`sudo`** l√† m·ªôt **binary setuid** l√† th·ª±c hi·ªán l·ªánh **`root`** thay m·∫∑t ng∆∞·ªùi d√πng u·ª∑ huy·ªÅn kh√°c.

Danh s√°ch c·ªßa ng∆∞·ªùi d√πng c√≥ th·ªÉ th·ª±c thi **`sudo`** c√≥ th·ªÉ x√°c ƒë·ªãnh nh∆∞ sau: (y√™u c·∫ßu quy·ªÅn **`root`**):

![2020-08-08 12.06.37.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/08-12-09-32-2020-08-08%2012.06.37.gif)

**C√∫ ph√°p** c·ªßa m·ªçi d√≤ng **`sudo`** nh∆∞ sau:

```shell
user machine=(effective_user) command
```

B·∫°n c√≥ th·ªÉ l·∫•y ƒë·∫∑c quy·ªÅn **`root`** b·∫±ng **c√∫ ph√°p** d∆∞·ªõi ƒë√¢y. ƒê√¢y l√† √Ω nghƒ©a:

- **`user`** l√† *username* c·ªßa ng∆∞·ªùi d√πng **`sudo`** m·ªõi.
- **`machine`** l√† m√°y ch·ªß m√† b√™n trong n√≥ **`sudo`** h·ª£p l·ªá.
- **`effective_user`**: l√† vi·∫øt t·∫Øt c·ªßa nh·ªØng ng∆∞·ªùi d√πng hi·ªáu qu·∫£ ƒë∆∞·ª£c ph√©p th·ª±c hi·ªán l·ªánh
- **`command`**: ƒë·∫°i di·ªán cho m·ªôt t·∫≠p h·ª£p c√°c l·ªánh m√† ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·∫°y

---

## 2. L·∫•y quy·ªÅn truy c·∫≠p file trong m·∫´u b√°t ph√¢n

S·ª≠ d·ª•ng l·ªánh **`stat`** ƒë·ªÉ l·∫•y quy·ªÅn truy c·∫≠p file trong m·∫´u b√°t ph√¢n nh∆∞ sau:

```shell
$ stat 0c "%a %n file"
```

T·ª´ trang ch√≠nh c·ªßa **`stat`**:

```shell
-c --format=FORMAT
%a    Quy·ªÅn truy c·∫≠p trong b√°t ph√¢n (Access rights in octal)
%n    T√™n file (file name)
```

**V√≠ d·ª• v·ªÅ files:**

```shell
$ stat -c "%a %n" .ssh/id_rsa
600 .ssh/id_rsa
```

**V√≠ d·ª• v·ªÅ Folders:**

```shell
$ stat c "%a %n" /var/www
755 /var/www
```

---

## 3.Cho ng∆∞·ªùi d√πng quy·ªÅn truy c·∫≠p **`root`**

ƒê·ªÉ cho ri√™ng ng∆∞·ªùi d√πng quy·ªÅn truy c·∫≠p **`root`**, b·∫°n c·∫ßn th√™m ng∆∞·ªùi d√πng v√†o nh√≥m quy·ªÅn truy c·∫≠p **`root`**.

N·∫øu b·∫°n mu·ªën t·∫°o m·ªõi ng∆∞·ªùi d√πng:

```shell
$ adduser newUser
$ passwd newUser
```

ƒê·ªÉ th√™m `newUser` v√† nh√≥m **`root`**, ch·∫°y 1 trong 2 l·ªánh sau:

```shell
$ adduser newUser root
```

```shell
$ usermod -aG root newUser
```

Ho·∫∑c c√≥ th·ªÉ cho n√≥ ƒë·∫∑c quy·ªÅn **`root`**:

```shell
$ visudo
# v√† th√™m c√°c d√≤ng d∆∞·ªõi sau:
newUser ALL=(ALL:ALL) ALL

# ƒê·∫∑c quy·ªÅn ng∆∞·ªùi d√πng ƒë·∫∑c bi·ªát
root    ALL=(ALL:ALL) ALL
newUser ALL=(ALL:ALL) ALL
```

**Ch√∫ √Ω:** C√°c ng∆∞·ªùi d√πng c·∫ßn ph·∫£i t·∫Øt v√† b·∫≠t l·∫°i ƒë·ªÉ thay ƒë·ªïi c√≥ hi·ªáu l·ª±c.

---

## 4. Ch·∫°y quy·ªÅn ph√≠a tr∆∞·ªõc v·ªõi quy·ªÅn **`root`**

Kh√¥ng bao g·ªìm **`sudo`** tr∆∞·ªõc 1 d√≤ng l·ªánh, ƒë√¥i l√∫c *quy·ªÅn truy c·∫≠p t·ª´ ch·ªëi* (**permission denied**) l√† tin nh·∫Øn b·∫°n c√≥ th·ªÉ nh·∫≠n.

L·ªánh **`sudo !!`** l√† c√°ch b·∫°n gi·∫£i quy·∫øt vi·ªác ƒë√≥

Nh·∫≠p nh·ªØng th·ª© sau ƒë√¢y:

```shell
$ rm -r private_file
```

B·∫°n s·∫Ω kh√¥ng c√≥ quy·ªÅn truy c·∫≠p ƒë·ªÉ th·ª±c thi tr·ª´ khi b·∫°n ƒë√£ ƒëƒÉng nh·∫≠p v·ªõi ƒë·∫∑c quy·ªÅn.

**`sudo !!`** l√† g√¨? N√≥ ch·∫°y c√°c l·ªánh tr∆∞·ªõc ƒë√≥ v·ªõi t∆∞ c√°ch **`root`**, nghƒ©a l√†:

```shell
$ sudo rm -r private_file
```

---

## 5. Th·ª±c thi l·ªánh v·ªõi **`sudo`** kh√¥ng c·∫ßn password

ƒê·ªÉ d√πng **`sudo`** kh√¥ng c·∫ßn password, b·∫°n c·∫ßn:

- Thi·∫øt l·∫≠p nh√≥m **`sudoers`** ƒë·ªÉ th·ª±c thi l·ªánh m√† kh√¥ng ƒë∆∞·ª£c **prompt**
- Thi·∫øt l·∫≠p n√≥ v·ªõi ch·ªâ **our user**.

G·ªçi **`visudo`** ƒë·ªÉ b·∫Øt ƒë·∫ßu v·ªõi ch·ªânh s·ª≠a **file** **``/etc/sudoers``** v√† thi·∫øt l·∫≠p b·∫≠t t√≠nh nƒÉng ƒë√≥ cho **group**.

**C√∫ ph√°p** cho c·∫•u h√¨nh ƒë·∫∑c quy·ªÅn **user** nh∆∞ sau:

```shell
user_list host_list = 
effective_user_list tag_list command_list
```

Trong ƒë√≥:

- **`user_list`**: Danh s√°ch c√°c ng∆∞·ªùi d√πng m√† cho ph√©p s·ª≠ d·ª•ng quy·ªÅn **`sudo`**
- **`host_list`**: Danh s√°ch c·ªßa c√°c **hosts** m√† ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ª≠ d·ª•ng quy·ªÅn **`sudo`**
- **`effective_user`**: Danh s√°ch m√† ng∆∞·ªùi d√πng hi·ªáu qu·∫£
- **`tag_list`**: danh s√°ch c·ªßa **tag**, nh∆∞ l√† *NOPASSWD*
- **`command_list`**: Danh s√°ch c·ªßa c√°c l·ªánh **`sudo`** ng∆∞·ªùi d√πng s·∫Ω ch·∫°y.

N·∫øu ch√∫ng ta mu·ªën k√≠ch ho·∫°t t·∫•t c·∫£ ng∆∞·ªùi d√πng **`%sudo`** ƒë·ªÉ ch·∫°y t·∫•t c·∫£ l·ªánh y√™u c·∫ßu quy·ªÅn **`sudo`** m√† kh√¥ng c·∫ßn **password**, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªánh sau:

```shell
$ %sudo ALL=NOPASSWD: ALL
```

C√°ch kh√°c c√°c k√≠ch ho·∫°t n√≥ ch·ªâ v·ªõi b·∫°n:

```shell
YourUserName ALL=(ALL) NOPASSWD: ALL
```

**Ch√∫ √Ω:** ƒê√¢y l√† vi·ªác kh√¥ng an to√†n cho b·∫£o m·∫≠t c·ªßa b·∫°n, b·∫°n n√™n tr√°nh l·∫£m ƒëi·ªÅu ƒë√≥, h√£y ƒë·ªÉ quy·ªÅn **`root`** lu√¥n c·∫ßn **password**.

| üîô¬†¬†[B√†i 14.M·∫πo qu·∫£n l√≠ ng∆∞·ªùi d√πng ph·∫ßn 2](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/14.Default%20Permissions.md) | [B√†i 16.L·ªãch s·ª≠ Terminal](https://github.com/Zenfection/Linux-for-babies/blob/master/USER%20%26%20FILE%20MANAGEMENT/16.Terminal%20history.md)¬†üîú |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
