# N·ªÅn t·∫£ng c·ªßa qu·∫£n l√≠ ti·∫øn tr√¨nh

## 1. Danh s√°ch ti·∫øn tr√¨nh s·ª≠ d·ª•ng **`ps`**

L·ªánh **`ps`** (vi·∫øt t·∫Øt c·ªßa *process status*) hi·ªÉn th·ªã th√¥ng tin v·ªÅ ti·∫øn tr√¨nh ƒëang ch·∫°y hi·ªán t·∫°i.

Kh√¥ng c·∫ßn b·∫•t k·ª≥ **`flags`** n√†o, **`ps`** s·∫Ω hi·ªÉn th·ªã t·∫•t c·∫£ ti·∫øn tr√¨nh ƒë√£ b·∫Øt ƒë·∫ßu b·ªüi ng∆∞·ªùi d√πng hi·ªán t·∫°i

**V√≠ d·ª•:**¬†¬†¬†¬†

![2020-08-11 15.09.36.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-10-01-2020-08-11%2015.09.36.gif)

Trong ƒë√≥ th√¨:

- **`PID`**: ID c·ªßa ti·∫øn tr√¨nh
- **`TTY`**: **Terminal** m√† l·ªánh ƒë∆∞·ª£c kh·ªüi ch·∫°y
- **`TIME`**: Kho·∫£ng th·ªùi gian ti·∫øn tr√¨nh ƒë√£ ch·∫°y
- **`CMD`**: t√™n c·ªßa l·ªánh (**command**)

M·ªôt c√°ch s·ª≠ d·ª•ng ph·ªï bi·∫øn c·ªßa **`ps`** l√† **`ps aux`**, n√≥ s·∫Ω hi·ªÉn th·ªã m·ªçi ti·∫øn tr√¨nh ƒëang ch·∫°y tr√™n h·ªá th·ªëng d·ªçc theo v·ªõi th√¥ng tin b·ªï sung (CPU,memory s·ª≠ d·ª•ng, user kh·ªüi ch·∫°y...)

N√≥ c≈©ng th∆∞·ªùng s·ª≠ d·ª•ng **`ps aux`** k·∫øt h·ª£p v·ªõi **`grep`** ƒë·ªÉ t√¨m ki·∫øm ti·∫øn tr√¨nh c·ª• th·ªÉ. H√£y nh√¨n n·∫øu server **SSH** **`sshd`** ƒëang ch·∫°y, h√£y ch·∫°y d√≤ng l·ªánh sau ƒë√¢y:

```shell
$ ps aux | grep sshd
```

![2020-08-11 15.16.20.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-17-28-2020-08-11%2015.16.20.gif)

Nh∆∞ b·∫°n ƒë√£ th·∫•y, **`zenfection`** ch√≠nh l√† user, **`2172`** ch√≠nh l√† ID c·ªßa ti·∫øn tr√¨nh, c√≤n nh·ªØng th√¥ng tin c√≤n l·∫°i bao g·ªìm time,  memory...

### T√¨m hi·ªÉu th√™m

| üåè¬†¬†[Ti·∫øn tr√¨nh c∆° b·∫£n](http://www.tldp.org/LDP/intro-linux/html/sect_04_01.html) |
| --------------------------------------------------------------------------------- |

---

## 2. C√¢y ti·∫øn tr√¨nh

M·ªçi ti·∫øn tr√¨nh ƒë√£ kh·ªüi ch·∫°y (ho·∫∑c "forked") b·ªüi m·ªôt ti·∫øn tr√¨nh n√†o kh√°c. C√≥ m·ªôt qu√° tr√¨nh **`root`** ƒë·∫∑c bi·ªát (g·ªçi l√† "**init**") ƒë∆∞·ª£c kh·ªüi ch·∫°y m·ªôt c√°ch tr·ª±c ti·∫øp b·ªüi **kernel** khi h·ªá th·ªëng ƒë·∫ßu ti√™n c·ªßa b·∫°n kh·ªüi ƒë·ªông.

Theo c√°ch n√†y, t·∫≠p h·ª£p c√°c ti·∫øn tr√¨nh ƒëang ch·∫°y trong h·ªá th·ªëng l√† m·∫´u c·ªßa m·ªôt "ti·∫øn tr√¨nh c√¢y"(*process tree*) b·∫Øt ngu·ªìn t·ª´ ti·∫øn tr√¨nh **init**. M·ªçi ti·∫øn tr√¨nh ƒë·ªÅu c√≥ nh·ªØng ti·∫øn tr√¨nh cha c·ªßa n√≥ v√† c√≥ kh·∫£ nƒÉng c√≥ nhi·ªÅu ti·∫øn tr√¨nh con.

**V√≠ d·ª•:** M·ªçi l√∫c b·∫°n ch·∫°y l·ªánh trong khi ·ªü promt **`bash`**, **`bash`** s·∫Ω **fork** m·ªôt ti·∫øn tr√¨nh m·ªõi ƒë·ªÉ ch·∫°y l·ªánh c·ªßa b·∫°n, l√†m cho ti·∫øn tr√¨nh ƒë√≥ tr·ªü th√†nh ti·∫øn tr√¨nh con c·ªßa **`bash`** hi·ªán t·∫°i.

C≈©ng nh∆∞ th·∫ø, khi b·∫°n nh√¨n th·∫•y "log in" tr√™n promt, th·ª±c ch·∫•t l·ªánh **`login`** ƒëang ch·∫°y. N·∫øu b·∫°n log in th√†nh c√¥ng, l·ªánh **`login`** s·∫Ω **fork** m·ªôt ti·∫øn tr√¨nh m·ªõi ƒë·ªÉ th·ª±c thi.

L·ªánh **`ps`** hi·ªÉn th·ªã danh s√°ch ph·∫≥ng c·ªßa ti·∫øn tr√¨nh, nh∆∞ng b·∫°n mu·ªën s·ª≠ d·ª•ng l·ªánh **`pstree`** n·∫øu b·∫°n mu·ªën xem hi·ªÉn th·ªã d·∫°ng danh s√°ch c√¢y.

**M·∫´u danh s√°ch c√¢y c·ªßa ti·∫øn tr√¨nh c·ªßa h·ªá th·ªëng Mac OS (Unix):**

![2020-08-11 15.44.45.gif](https://raw.githubusercontent.com/Zenfection/Image/master/2020/08/11-15-45-40-2020-08-11%2015.44.45.gif)

B·∫°n c≈©ng c√≥ th·ªÉ d√πng l·ªánh **`ps auxf`** ƒë·ªÉ xem hi·ªÉn th·ªã d·∫°ng c√¢y, m·∫∑c d√π ƒë·∫ßu ra kh√¥ng m·∫•y th√¢n thi·ªán ng∆∞·ªùi d√πng l·∫Øm.

---

## 3. N·ªÅn t·∫£ng c·ªßa ti·∫øn tr√¨nh Ownership

M·ªçi ti·∫øn tr√¨nh "*owned*" b·ªüi m·ªôt ng∆∞·ªùi d√πng nh·∫•t ƒë·ªãnh. Ti·∫øn tr√¨nh **owned** b·ªüi m·ªôt ng∆∞·ªùi d√πng c√≥ quy·ªÅn truy c·∫≠p l√†m b·∫•t k·ª≥ th·ª© g√¨ m√† ng∆∞·ªùi d√πng c√≥ th·ªÉ l√†m n·∫øu h·ªç ƒëƒÉng nh·∫≠p tr·ª±c ti·∫øp.

**V√≠ d·ª•:** N·∫øu **files** c·ªßa b·∫°n  ƒë√£ **owned** b·ªüi **`zen`** sau ƒë√≥ qu√° tr√¨nh ƒë√≥ c√≥ quy·ªÅn truy c·∫≠p l√†m m·ªçi th·ª©: **`zen`** c√≥ th·ªÉ s·ª≠a **files** trong **home directory**, b·∫Øt ƒë·∫ßu m·ªôt ti·∫øn tr√¨nh m·ªõi...

Ti·∫øn tr√¨nh h·ªá th·ªëng nh∆∞ **`init`** v√† **`login`** l√† **owned** (quy·ªÅn s·ªü h·ªØu) b·ªüi **`root`** v√† khi ti·∫øn tr√¨nh **`root`**-owned **forks** m·ªôt ti·∫øn tr√¨nh m·ªõi, c√≥ kh·∫£ nƒÉng s·∫Ω thay ƒë·ªïi ch·ªß s·ªü h·ªØu (**owner**) c·ªßa ti·∫øn tr√¨nh con.

Do ƒë√≥, khi b·∫°n ƒëƒÉng nh·∫≠p v√†o l·ªánh **`login`** s·∫Ω **fork** ra m·ªôt ti·∫øn tr√¨nh m·ªõi ch·∫°y **`shell`** c·ªßa b·∫°n, nh∆∞ng ti·∫øn tr√¨nh m·ªõi s·∫Ω **owned** b·ªüi ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p th√†nh c√¥ng. B·∫•t k·ª≥ l·ªánh ti·∫øp theo n√†o kh·ªüi ch·∫°y s·∫Ω thu·ªôc s·ªü h·ªØu c·ªßa ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p.

B·ªüi v√¨ ch·ªâ c√≥ duy nh·∫•t ti·∫øn tr√¨nh **`root`** c√≥ th·ªÉ thay ƒë·ªïi quy·ªÅn s·ªü h·ªØu trong c√°ch n√†y.

---

## 4. H·ªá th·ªëng **`init`** l√† g√¨?

ƒêi·ªÅu cu·ªëi c√πng c·ªßa **kernel** l√†m trong qu√° tr√¨nh kh·ªüi t·∫°o c·ªßa n√≥ l√† b·∫Øt ƒë·∫ßu "h·ªá th·ªëng **`init`**", th√¥ng th∆∞·ªùng l√† ch·∫°y l·ªánh **``/sbin/init``**.

C√≥ r·∫•t nhi·ªÅu h·ªá th·ªëng **`init`** kh√°c nhau, nh∆∞ng ch√∫ng ƒëi·ªÅu gi·ªëng nhau nh·ªØng th·ª© sau ƒë√¢y:

- Ki·ªÉm so√°t **services** n√†o b·∫Øt ƒë·∫ßu khi kh·ªüi ƒë·ªông
- Cung c·∫•p **tools** cho **services** kh·ªüi ch·∫°y, d·ª´ng **services** v√† cho t·ªïng th·ªÉ th√¥ng tin v·ªÅ tr·∫°ng th√°i **service**.
- Cung c·∫•p m·ªôt **framework** cho ghi **services** m·ªõi

"**service**" ·ªü ƒë√¢y l√† bao g·ªìm m·ªçi th·ª© t·ª´ **web server** ƒë·∫øn **system-level servers** ƒë∆∞·ª£c s·ª≠ d·ª•ng qu·∫£n l√≠ ƒëƒÉng nh·∫≠p.

V·ªÅ c∆° b·∫£n, vi·ªác c·ªßa m·ªôt h·ªá th·ªëng **`init`**¬†l√† l·∫•y t·∫•t c·∫£ ch∆∞∆°ng tr√¨nh **user-facing** (nh∆∞ l√† non-kernel...) v√† **services** ƒëang ch·∫°y.

Trong qu√° kh·ª©, h·ªá th·ªëng **init** ph·ªï bi·∫øn ƒë∆∞·ª£c g·ªçi l√† "**System V init**", c√°i t√™n ƒë∆∞·ª£c ƒë·∫∑t t·ª´ **UNIX System V**. G·∫ßn ƒë√¢y h∆°n trong **Linux**, **systemd init system** ƒë√£ d·∫ßn ·ªü tr√™n ph·ªï bi·∫øn h∆°n do ·∫£nh h∆∞·ªüng c√°c **Linux distro** nh∆∞ : **Cent OS, RedHat, Debian, Ubuntu** v√† m·ªôt s·ªë kh√°c.

Do ƒë√≥ c√≥ 2 ƒëi·ªÅu n√™n ghi nh·ªõ v·ªÅ **Linux init system**:

1. Kh√°c b·∫£n ph√¢n ph·ªëi **Linux** c√≥ th·ªÉ s·ª≠ d·ª•ng kh√°c **init systems**
2. Kh√°c phi√™n b·∫£n c·ªßa c√πng m·ªôt b·∫£n ph√¢n ph·ªëi **Linux** c√≥ th·ªÉ s·ª≠ d·ª•ng kh√°c **init systems**

**V√≠ d·ª•:** **systemd** tr·ªü th√†nh **init system** m·∫∑c ƒë·ªãnh tr√™n **Ubuntu** t·ª´ b·∫£n v15.04 (ra m·∫Øt v√†o nƒÉm **2015**).

---

## 5. D·ª´ng ti·∫øn tr√¨nh v·ªõi **`kill`** v√† **`killall`**

ƒê√¥i l√∫c b·∫°n mu·ªën **kill** m·ªôt ti·∫øn tr√¨nh m√† n√≥ ti√™u hao qu√° nhi·ªÅu t√†i nguy√™n ho·∫∑c n·∫øu kh√¥ng th√¨ n√≥ kh√¥ng ph·∫£n h·ªìi. C√≥ 2 **tool** ph·ªï bi·∫øn trong vi·ªác n√†y ƒë√≥ l√† **`kill`** v√† **`killall`**.

L·ªánh **`kill`** c·∫ßn cung c·∫•p m·ªôt **ID** ti·∫øn tr√¨nh (ho·∫∑c **PID**), c√≥ th·ªÉ t√¨m n√≥ b·∫±ng c√°ch s·ª≠ d·ª•ng l·ªánh **`ps`**. L·ªánh **`killall`** c·∫ßn cung c·∫•p m·ªôt t√™n c·ªßa ti·∫øn tr√¨nh, sau ƒë√≥ n√≥ s·∫Ω c·ªë g·∫Øng **kill** m·ªçi ti·∫øn tr√¨nh v·ªõi t√™n c·ªßa ti·∫øn tr√¨nh ƒë√≥.

Xem x√©t **v√≠ d·ª•** sau b·∫±ng **`ps`**:

```shell
$ ps
    PID TTY            TIME CMD
20735   ttys000     0:00.10 -bash
 3086   ttys002     0:00.70 -bash
```

Ch√∫ng ta c√≥ hai ti·∫øn tr√¨nh **`bash`** ƒëang ch·∫°y, ti·∫øn tr√¨nh 1 v·ªõi **`PID`** l√† *20735* v√† ti·∫øn tr√¨nh 2 v·ªõi **`PID`** l√† *3086*. H√£y ch·∫°y l·ªánh **`kill 3086`** th√¨ l·∫≠p t·ª©c h·ªá ƒëi·ªÅu n√†y s·∫Ω g·ª≠i "*gracefull shutdown*" t√≠n hi·ªáu ƒë√≥ cho ti·∫øn tr√¨nh **bash** c·ª• th·ªÉ tr√™n, khi ch·∫°y l·ªánh **`killall bash`** s·∫Ω g√¢y ra cho h·ªá ƒëi·ªÅu h√†nh b·∫Øt bu·ªôc tho√°t m·ªçi ti·∫øn tr√¨nh **`bash`**.

### G·ª≠i t√≠n hi·ªáu kh√°c nhau

B·ªüi m·∫∑c ƒë·ªãnh, **`kill`** v√† **`killall`** s·∫Ω g·ª≠i t√≠n hi·ªáu **`TERM`** t·ªõi ti·∫øn tr√¨nh x√°c ƒë·ªãnh. T√≠n hi·ªáu **`TERM`** l√† m·ªôt "*graceful*" t√≠n hi·ªáu b·∫Øt bu·ªôc tho√°t.

**V√≠ d·ª•:** M·ªôt ti·∫øn tr√¨nh c√≥ th·ªÉ mu·ªën ho√†n th√†nh n√≥ tr∆∞·ªõc khi b·∫Øt bu·ªôc tho√°t ho·∫∑c clean up m·ªôt s·ªë file t·∫°m th·ªùi m√† n√≥ c√≤n s√≥t l·∫°i tr√™n h·ªá th·ªëng.

N·∫øu m·ªôt qu√° tr√¨nh c√≥ **bug** s·∫Ω khi·∫øn n√≥ kh√¥ng ph·∫£n h·ªìi th√¨ n√≥ kh√¥ng th·ªÉ x·ª≠ l√Ω t√≠n hi·ªáu **`TERM`**. Trong tr∆∞·ªùng h·ª£p ƒë√≥, b·∫°n c√≥ th·ªÉ g·ª≠i t√≠n hi·ªáu kh√°c nh∆∞ l√† **`KILL`**.

C√≥ 2 c√°ch ƒë·ªÉ l√†m ƒëi·ªÅu ƒë√≥:

1. **`kill -KILL 3086`**, ·ªü ƒë√¢y **`3086`** gi·∫£ ƒë·ªãnh l√† ID ti·∫øn tr√¨nh m√† b·∫°n mu·ªën **kill**
2. **`kill -9 3086`**

M·ªçi t√≠n hi·ªáu s·∫Ω cho m·ªôt gi√° tr·ªã s·ªë v√† gi√° tr·ªã ƒë√≥ cho **`KILL`** l√† **`9`**, n√™n **`KILL`** v√† **`9`** l√† nh∆∞ nhau.

L·ªánh **`kill -9`** v√† **`killall -9`** l√† hai l·ªánh c·ª±c k·ª≥ m·∫°nh, n√≥ t∆∞∆°ng ƒë∆∞∆°ng v·ªõi vi·ªác b·∫°n t·∫Øt m√°y t√≠nh ho·∫∑c r√∫t d√¢y ngu·ªìn m√°y t√≠nh c·ªßa b·∫°n. Vi·ªác **kill** m·ªôt ti·∫øn tr√¨nh c√≥ th·ªÉ ƒë·ªÉ l·∫°i m·ªôt m·ªõ h·ªón ƒë·ªôn, nh∆∞ng n√≥ c≈©ng c√≥ c√°ch duy nh·∫•t ƒë·ªÉ gi·∫£i quy·∫øt t√¨nh tr·∫°ng kh√¥ng ph·∫£n h·ªìi

T√¥i khuy√™n b·∫°n n√™n **lu√¥n lu√¥n** n√™n d√πng l·ªánh **kill PID** tr∆∞·ªõc khi ƒë·ª•ng t·ªõi l·ªánh **`kill -9 PID`**

### T√¨m hi·ªÉu th√™m

| üåè¬†[T√≠n hi·ªáu Kill](http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_01.html) |
| --------------------------------------------------------------------------------- |

| [B√†i 2.File streams](https://github.com/Zenfection/Linux-for-babies/blob/master/Jobs%20%26%20Processes%2C%20Data%20Manipulation/2.File%20Streams.md)¬†üîú |
| ------------------------------------------------------------------------------------------------------------------------------------------------------- |
